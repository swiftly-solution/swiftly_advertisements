name: "swiftly_advertisements Compiler"

on:
    push:
        branches:
            - "*"
    pull_request:

jobs:
    build:
        name: Build
        runs-on: ${{ matrix.os }}

        container: ${{ matrix.container }}
        strategy:
            fail-fast: false
            matrix:
                os: [self-hosted, windows-latest]
                include:
                    - os: windows-latest
                    - os: self-hosted
                      container: registry.gitlab.steamos.cloud/steamrt/sniper/sdk

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  path: swiftly_advertisements
                  submodules: recursive

            - name: Checkout Swiftly
              uses: actions/checkout@v4
              with:
                  repository: swiftly-solution/swiftly
                  ref: master
                  path: swiftly

            - name: Installing Swiftly Scripting files
              run: |
                  cd swiftly; mv plugin_files/scripting/* ..; cd ..

            - name: Build
              working-directory: swiftly_advertisements
              run: |
                  make

            - name: Upload Files - Linux
              if: matrix.os == 'self-hosted'
              uses: actions/upload-artifact@v3
              with:
                  name: swiftly_advertisements Plugin - Linux
                  path: ${{ github.workspace }}/swiftly_advertisements/output

            - name: Upload Files - Windows
              if: matrix.os == 'windows-latest'
              uses: actions/upload-artifact@v3
              with:
                  name: swiftly_advertisements Plugin - Windows
                  path: ${{ github.workspace }}/swiftly_advertisements/output
